
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://outdated.legendu.net/theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
        disabled="disabled"
    href="https://outdated.legendu.net/theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
            disabled="disabled"
          href="https://outdated.legendu.net/theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="https://outdated.legendu.net/theme/pygments/github.min.css">


  <link rel="stylesheet"
        type="text/css"
        href="https://outdated.legendu.net/theme/stork/stork.css" />

  <link rel="stylesheet" type="text/css" href="https://outdated.legendu.net/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://outdated.legendu.net/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://outdated.legendu.net/theme/font-awesome/css/solid.css">







 

<meta name="author" content="Ben Chuanlong Du" />
<meta name="description" content="Things under legendu.net/outdated are outdated technologies that the author does not plan to update any more. Please look for better alternatives. It is suggested that you use Python instead of q to manipulate text files! Installation on Ubuntu wajig install python3-q-text-as-data General Tips The semantics of q is …" />
<meta name="keywords" content="programming, SQL, structured text, CSV, TSV">


  <meta property="og:site_name" content="Ben Chuanlong Du's Blog"/>
  <meta property="og:title" content="Use q to Query Text File Using SQL Syntax"/>
  <meta property="og:description" content="Things under legendu.net/outdated are outdated technologies that the author does not plan to update any more. Please look for better alternatives. It is suggested that you use Python instead of q to manipulate text files! Installation on Ubuntu wajig install python3-q-text-as-data General Tips The semantics of q is …"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="https://outdated.legendu.net/blog/q-query-text-file-sql/"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2016-06-05 16:19:58-07:00"/>
  <meta property="article:modified_time" content="2020-03-05 16:19:58-08:00"/>
  <meta property="article:author" content="https://outdated.legendu.net/author/ben-chuanlong-du.html">
  <meta property="article:section" content="Programming"/>
  <meta property="article:tag" content="programming"/>
  <meta property="article:tag" content="SQL"/>
  <meta property="article:tag" content="structured text"/>
  <meta property="article:tag" content="CSV"/>
  <meta property="article:tag" content="TSV"/>
  <meta property="og:image" content="">

  <title>Ben Chuanlong Du's Blog &ndash; Use q to Query Text File Using SQL Syntax</title>


</head>
<body class="light-theme">

<aside>
  <div>
    <a href="https://outdated.legendu.net/">
      <img src="https://outdated.legendu.net/theme/img/profile.png" alt="" title="">
    </a>

    <h1>
      <a href="https://outdated.legendu.net/"></a>
    </h1>

    <p>Change is eternal.</p>

    <div class="stork">
      <input class="stork-input" type="text" autocomplete="off" name="q" data-stork="sitesearch" placeholder="Search..."/>
      <div class="stork-output" data-stork="sitesearch-output"></div>
    </div>


    <ul class="social">
      <li>
        <a class="sc-linkedin"
           href="https://www.linkedin.com/in/ben-chuanlong-du-1239b221/"
           target="_blank">
          <i class="fa-brands fa-linkedin"></i>
        </a>
      </li>
      <li>
        <a class="sc-github"
           href="https://github.com/legendu-net/"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
      <li>
        <a class="sc-stack-overflow"
           href="https://stackoverflow.com/users/7808204/benjamin-du?tab=profile"
           target="_blank">
          <i class="fa-brands fa-stack-overflow"></i>
        </a>
      </li>
      <li>
        <a class="sc-docker"
           href="https://hub.docker.com/u/dclong"
           target="_blank">
          <i class="fa-brands fa-docker"></i>
        </a>
      </li>
      <li>
        <a class="sc-twitter"
           href="https://twitter.com/longendu"
           target="_blank">
          <i class="fa-brands fa-twitter"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>

<nav>
  <a href="https://www.legendu.net">Home</a>
  <a href="https://outdated.legendu.net">Blog</a>
  <a href="https://outdated.legendu.net/archives.html">Archives</a>
  <a href="https://outdated.legendu.net/categories.html">Categories</a>
  <a href="https://outdated.legendu.net/tags.html">Tags</a>
  <a href="https://www.legendu.net/pages/about">About</a>


</nav>

<article class="single">
  <header>
      
    <h1 id="q-query-text-file-sql">Use q to Query Text File Using SQL Syntax</h1>
    <p>
      Posted on Jun 05, 2016 in <a href="https://outdated.legendu.net/category/programming.html">Programming</a>

    </p>
  </header>


  <div>
    <p><strong>Things under legendu.net/outdated are outdated technologies that the author does not plan to update any more. Please look for better alternatives.</strong></p>
<p>It is suggested that you use Python 
instead of <a href="http://harelba.github.io/q/">q</a> 
to manipulate text files!</p>
<h2 id="installation-on-ubuntu">Installation on Ubuntu</h2>
<div class="highlight"><pre><span></span><code>wajig<span class="w"> </span>install<span class="w"> </span>python3-q-text-as-data
</code></pre></div>

<h2 id="general-tips">General Tips</h2>
<ol>
<li>
<p>The semantics of <code>q</code> is identical to <code>sqlite</code>. 
    <code>q</code> preserve the original order of rows if no sorting (order by) is applied.
    You force querying by the order of insertion 
    by adding an <code>order by rowid</code> if needed (similar to sqlite).</p>
</li>
<li>
<p>Output in quote mode does not work well. 
    Double quotes are not escaped.</p>
</li>
<li>
<p>Joins do not work on files with different separators. 
    You have to convert them to have the same field separator first
    and then perform joins. </p>
</li>
<li>
<p>If no header, then use c<span class="math">\(i\)</span> to stand for the <span class="math">\(i^{th}\)</span> column.</p>
</li>
</ol>
<h2 id="examples">Examples</h2>
<ol>
<li>
<p>Randomly select 500 records.</p>
<div class="highlight"><pre><span></span><code><span class="nv">q</span><span class="w"> </span><span class="s2">&quot;select * from text_file order by random() limit 5&quot;</span>
</code></pre></div>

</li>
<li>
<p>Sample with acceptance ratio 0.01.</p>
<div class="highlight"><pre><span></span><code><span class="nv">q</span><span class="w"> </span><span class="s2">&quot;select * from text_file where random() % 100 = 0&quot;</span>
</code></pre></div>

</li>
<li>
<p>Use <code>-</code> to stand the piped in output. </p>
<div class="highlight"><pre><span></span><code>head -n 1000 text_file | q &quot;select * from - where age &lt; 30&quot;
</code></pre></div>

</li>
<li>
<p>Use q to find Docker images without repository names.</p>
<div class="highlight"><pre><span></span><code>docker images | tail -n +2 | q &#39;select c3 from - where c1 = &quot;&lt;none&gt;&quot;&#39;
</code></pre></div>

</li>
<li>
<p>Remove all images belong to the eclipse organization with the help of sed and q.</p>
<div class="highlight"><pre><span></span><code><span class="n">docker</span><span class="w"> </span><span class="n">images</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">sed</span><span class="w"> </span><span class="err">&#39;</span><span class="n">s</span><span class="o">/</span><span class="w"> </span><span class="err">\</span><span class="o">+/</span><span class="err">\</span><span class="n">t</span><span class="o">/</span><span class="n">g</span><span class="err">&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">-</span><span class="n">tH</span><span class="w"> </span><span class="s">&quot;select [image id] from - where repository like &#39;eclipse/%&#39;&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">xargs</span><span class="w"> </span><span class="n">docker</span><span class="w"> </span><span class="n">rmi</span>
</code></pre></div>

</li>
</ol>
<h2 id="alternative-tools">Alternative Tools</h2>
<ol>
<li>
<p><a href="https://github.com/dinedal/textql">textql</a> (developed in Go) 
    is a very similar tool to <a href="http://harelba.github.io/q/">q</a>.
    It has even simplier syntax than q.
    However, 
    it has several disadvantages compared to q.
    First, it is not as actively maintained as q.
    Second, no easy way to install except in Mac (using Homebrew). 
    You have to install from source by yourself in Linux and Windows.</p>
</li>
<li>
<p>You can import text files into database tables and work on them. 
    SQLite3 is a great choice (of embeded database). 
    As a matter of fact, 
    both q and textql are based on SQLite3.
    You can refer to https://www.sqlite.org/cvstrac/wiki?p=ImportingFiles 
    on how to importing files into SQLite3.
    If you prefer a client-server database, 
    you can either MySQL, etc. </p>
<div class="highlight"><pre><span></span><code>CREATE TABLE foo (
    id Int, 
    msg VarChar(255), 
    value Decimal(8, 4)
)
;

LOAD DATA INFILE &#39;/tmp/data.txt&#39; 
INTO TABLE foo
;
</code></pre></div>

</li>
</ol>
<h2 id="references">References</h2>
<p>http://harelba.github.io/q/</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js','color.js','mhchem.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://outdated.legendu.net/tag/programming.html">programming</a>
      <a href="https://outdated.legendu.net/tag/sql.html">SQL</a>
      <a href="https://outdated.legendu.net/tag/structured-text.html">structured text</a>
      <a href="https://outdated.legendu.net/tag/csv.html">CSV</a>
      <a href="https://outdated.legendu.net/tag/tsv.html">TSV</a>
    </p>
  </div>






<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'dclong';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    Please enable JavaScript to view comments.
</noscript>
<!-- End Disqus -->
</article>

<footer>
<p>&copy;  </p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="https://outdated.legendu.net/theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="False"
          data-default-theme="light"
          type="text/javascript">
  </script>
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Ben Chuanlong Du's Blog ",
  "url" : "https://outdated.legendu.net",
  "image": "",
  "description": ""
}
</script><a href="https://github.com/dclong/outdated" target="_blank" class="github-corner" aria-label="View source on Github">
    <svg width="80"
         height="80"
         viewBox="0 0 250 250"
         style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;"
         aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor"
              style="transform-origin: 130px 106px;"
              class="octo-arm">
        </path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor"
              class="octo-body">
        </path>
    </svg>
</a>
  <script src="https://outdated.legendu.net/theme/stork/stork.js"></script>
  <script>
    stork.register("sitesearch", "https://outdated.legendu.net/search-index.st", {showProgress: false});
  </script>

</body>
</html>