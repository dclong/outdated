
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://outdated.legendu.net/theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
        disabled="disabled"
    href="https://outdated.legendu.net/theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
            disabled="disabled"
          href="https://outdated.legendu.net/theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="https://outdated.legendu.net/theme/pygments/github.min.css">


  <link rel="stylesheet"
        type="text/css"
        href="https://outdated.legendu.net/theme/stork/stork.css" />

  <link rel="stylesheet" type="text/css" href="https://outdated.legendu.net/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://outdated.legendu.net/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://outdated.legendu.net/theme/font-awesome/css/solid.css">







 

<meta name="author" content="Ben Chuanlong Du" />
<meta name="description" content="Things under legendu.net/outdated are outdated technologies that the author does not plan to update any more. Please look for better alternatives. ** Things under legendu.net/outdated are outdated technologies that the author does not plan to update any more. Please look for better alternatives. ** Teradata Open Source Project …" />
<meta name="keywords" content="programming, tips, Teradata SQL, database">


  <meta property="og:site_name" content="Ben Chuanlong Du's Blog"/>
  <meta property="og:title" content="Tips on Teradata SQL"/>
  <meta property="og:description" content="Things under legendu.net/outdated are outdated technologies that the author does not plan to update any more. Please look for better alternatives. ** Things under legendu.net/outdated are outdated technologies that the author does not plan to update any more. Please look for better alternatives. ** Teradata Open Source Project …"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="https://outdated.legendu.net/blog/teradata-sql-tips/"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2014-05-15 12:10:03-07:00"/>
  <meta property="article:modified_time" content="2021-02-15 12:10:03-08:00"/>
  <meta property="article:author" content="https://outdated.legendu.net/author/ben-chuanlong-du.html">
  <meta property="article:section" content="Computer Science"/>
  <meta property="article:tag" content="programming"/>
  <meta property="article:tag" content="tips"/>
  <meta property="article:tag" content="Teradata SQL"/>
  <meta property="article:tag" content="database"/>
  <meta property="og:image" content="">

  <title>Ben Chuanlong Du's Blog &ndash; Tips on Teradata SQL</title>


</head>
<body class="light-theme">

<aside>
  <div>
    <a href="https://outdated.legendu.net/">
      <img src="https://outdated.legendu.net/theme/img/profile.png" alt="" title="">
    </a>

    <h1>
      <a href="https://outdated.legendu.net/"></a>
    </h1>

    <p>Change is eternal.</p>

    <div class="stork">
      <input class="stork-input" type="text" autocomplete="off" name="q" data-stork="sitesearch" placeholder="Search..."/>
      <div class="stork-output" data-stork="sitesearch-output"></div>
    </div>


    <ul class="social">
      <li>
        <a class="sc-linkedin"
           href="https://www.linkedin.com/in/ben-chuanlong-du-1239b221/"
           target="_blank">
          <i class="fa-brands fa-linkedin"></i>
        </a>
      </li>
      <li>
        <a class="sc-github"
           href="https://github.com/legendu-net/"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
      <li>
        <a class="sc-stack-overflow"
           href="https://stackoverflow.com/users/7808204/benjamin-du?tab=profile"
           target="_blank">
          <i class="fa-brands fa-stack-overflow"></i>
        </a>
      </li>
      <li>
        <a class="sc-docker"
           href="https://hub.docker.com/u/dclong"
           target="_blank">
          <i class="fa-brands fa-docker"></i>
        </a>
      </li>
      <li>
        <a class="sc-twitter"
           href="https://twitter.com/longendu"
           target="_blank">
          <i class="fa-brands fa-twitter"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>

<nav>
  <a href="https://www.legendu.net">Home</a>
  <a href="https://outdated.legendu.net">Blog</a>
  <a href="https://outdated.legendu.net/archives.html">Archives</a>
  <a href="https://outdated.legendu.net/categories.html">Categories</a>
  <a href="https://outdated.legendu.net/tags.html">Tags</a>
  <a href="https://www.legendu.net/pages/about">About</a>


</nav>

<article class="single">
  <header>
      
    <h1 id="teradata-sql-tips">Tips on Teradata SQL</h1>
    <p>
      Posted on May 15, 2014 in <a href="https://outdated.legendu.net/category/computer-science.html">Computer Science</a>

    </p>
  </header>


  <div>
    <p><strong>Things under legendu.net/outdated are outdated technologies that the author does not plan to update any more. Please look for better alternatives.</strong></p>
<p>**
Things under legendu.net/outdated are outdated technologies 
that the author does not plan to update any more. 
Please look for better alternatives.
**</p>
<ul>
<li><a href="https://github.com/Teradata">Teradata Open Source Project on GitHub</a></li>
<li><a href="http://cuishen.iteye.com/blog/638968">Teradata SQL笔记</a></li>
<li><a href="http://www.loyhome.com/%E6%97%A0%E7%9F%A5%E7%9A%84%E6%AF%94%E8%BE%83%EF%BC%9Ar%E5%92%8Cteradata-sql%E9%99%84%E8%B5%A0td%E7%BB%8F%E9%AA%8C%E5%87%A0%E6%9E%9A/">无知的比较：R和Teradata SQL(附赠TD经验几枚)</a></li>
<li><a href="http://sqlfool.com/mssql-dba-guide-to-teradata/">The SQL Server DBA’s Guide to Teradata</a></li>
</ul>
<h2 id="syntax">Syntax</h2>
<p>Please refer to 
<a href="http://www.legendu.net/2014/blog/syntax-of-teradata-sql">Syntax of Teradata SQL</a>
.</p>
<h2 id="performance-tips">Performance Tips</h2>
<p>http://www.legendu.net/misc/blog/sql-tips/#performance</p>
<h2 id="trick-and-trap">Trick and Trap</h2>
<ol>
<li>
<p>Must use on commit preserve rows to persist data if you create a volatile table.</p>
</li>
<li>
<p>Data cast using parentheses is discouraged in Teradata SQL. 
    Use the <code>CAST</code> function instead. 
    Another way is to use suffix to indicate the type of literal values, 
    e.g., <code>'1'XI8</code>.</p>
</li>
<li>
<p>Below code get informtion about the table <code>cat123</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">dbc</span><span class="p">.</span><span class="n">TablesV</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">DataBaseName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">TableName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;cat123&#39;</span>
</code></pre></div>

</li>
<li>
<p>Instead of using macros of other extensions of SQL
    (which many versions of SQL does not support),
    an better alternative is to call SQL in other languages (Python, R, etc.).
    This also makes it easier to do visualization or generalize reports.</p>
</li>
<li>
<p>In Teradata, the maximum row size is approx 64K bytes.
    So that you cannot define columns of size greater than 64K.
    For example,
    you cannot define a column of size 65K.</p>
</li>
<li>
<p>You cannot create a new table using <code>insert into</code>.
    <code>insert into</code> can only insert into an existing table.</p>
</li>
</ol>
<h2 id="volatile">Volatile</h2>
<p>There is no way to check if a specific Volatile Table exists besides HELP VOLATILE TABLE which returns all VT.
identity, auto increment]: 
1. better not to set value by yourself (even if you can) as confliction might happen later; 
2. insert one by one works well however insert into using select seems not to work as expected ...
    over (order by field) necessary for row_number() etc.? 
    u can use order by 0 if no ordering wanted ..., and is probably faster ...</p>
<h2 id="syntax_1">Syntax</h2>
<ol>
<li>
<p>Always end a complete Teradata SQL statement with a semicolon.
    Sometimes in Some SQL (e.g., SAS),
    the codes runs OK without an ending semicolon but sometimes might not.
    It is always good practice to end a complete SQL statement with a semicolon.</p>
</li>
<li>
<p>Commands in Teradata (and other versions of SQL) SQL are case-insensitive.</p>
</li>
<li>
<p>You can use <code>sel</code> as short for <code>select</code> in Teradata SQL,
    however,
    it is suggested that you always use <code>select</code> instead of <code>sel</code>.
    This is because <code>sel</code> is not support in some other versions of SQL.
    You can use SQL template to generate code for you if you are tired of typing.</p>
</li>
<li>
<p>Use <code>--</code> for one line comment and <code>/*...*/</code> for multiple line comment.
    The <code>/*...*/</code> way is recommended as it is a widely used way for commenting.</p>
</li>
<li>
<p>The <code>as</code> keyword is optional when creating column aliases,
    however,
    it is tricky in <code>create table</code> statement.
    When you create table schema,
    you cannot not use the keyword <code>as</code>
    but when you create a table using a query you must use the keyword <code>as</code>.</p>
<div class="highlight"><pre><span></span><code>create table A /*no as here*/(
    a integer,
    b char(20),
    c decimal(12,3),
    d date
)
;

create table A as /*must use as here*/(
    select * from B
)
with data
primary index (id)
;
</code></pre></div>

</li>
<li>
<p><code>union (all)</code> does not match column names.
    Columns of the two tables to be united together must have the same order.
    If the types of a column does not match,
    then the type of the first column is used
    and the corresponding columns of other tables will be casted into this type.</p>
</li>
<li>
<p>Both count and sum can be used to count the number of rows satisfying some condition.
    Generally speaking, count is preferred because it is able to remove duplicated records.
    For example, suppose we have a table A with columns <code>case_id</code> (non-unique)
    and <code>sar</code> (Y or N). We can count the number of rows with <code>sar = Y</code> using</p>
<div class="highlight"><pre><span></span><code><span class="nv">sum</span><span class="ss">(</span>
<span class="w">    </span><span class="nv">case</span><span class="ss">(</span>
<span class="w">        </span><span class="nv">when</span><span class="w"> </span><span class="nv">sar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Y&#39;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="mi">1</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="mi">0</span>
<span class="w">    </span><span class="k">end</span><span class="ss">)</span>
<span class="ss">)</span><span class="w"> </span><span class="nv">as</span><span class="w"> </span><span class="nv">n</span>
</code></pre></div>

<p>How,
if <code>case_id</code> has duplicated values and we want to count the number of distinct cases with <code>sar = 1</code>,
then <code>sum</code> does not work well. In stead, we can use</p>
<div class="highlight"><pre><span></span><code><span class="nv">count</span><span class="ss">(</span>
<span class="w">    </span><span class="nv">case</span><span class="ss">(</span>
<span class="w">        </span><span class="nv">when</span><span class="w"> </span><span class="nv">sar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Y&#39;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nv">case_id</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="nv">null</span>
<span class="w">        </span><span class="k">end</span><span class="ss">)</span>
<span class="ss">)</span><span class="w"> </span><span class="nv">as</span><span class="w"> </span><span class="nv">n</span>
</code></pre></div>

<p>It is recommended that you always use <code>count</code> to count rows satisfying a condition.</p>
</li>
<li>
<p>In a case statement,
    at most one <code>when/else</code> branch is executed.
    As soon as a <code>when/else</code> statement is executed,
    it jumps out (like <code>break;</code> in C) of the case statement instead of continuing to the next branch.</p>
</li>
<li>
<p>Do not use natural joins (relying on same column names for joining) as it is dangerous to do so.</p>
</li>
<li>
<p>When joining multiple tables,
    SQL will determine the best way to perform the joins.
    So do not help the SQL compiler when you do multiple joins.</p>
</li>
<li>
<p>The precedence of logical operators are <code>not</code>, <code>and</code> and <code>or</code>.
    However,
    it is suggested that you always use parentheses to make your code easier to understand.</p>
</li>
<li>
<p>Displays the code used to generate the view or table.</p>
<div class="highlight"><pre><span></span><code><span class="k">show</span><span class="w"> </span><span class="nv">table</span><span class="w"> </span><span class="nv">table_name</span><span class="c1">;</span>
</code></pre></div>

</li>
<li>
<p>Display table schema (i.e., show column names and attributes).</p>
<div class="highlight"><pre><span></span><code>help table table_name;
</code></pre></div>

<p>or you can use</p>
<div class="highlight"><pre><span></span><code>help column table_name.*;
</code></pre></div>

</li>
</ol>
<h2 id="null-values">Null Values</h2>
<ol>
<li>Most functions in SQL (unless specially for <code>null</code> values) ignore
    <code>null</code> values like they never appear in the table.</li>
</ol>
<h3 id="create-an-empty-table">Create an Empty Table</h3>
<p>You can manually specify the structure of the table.</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="cm">/*no as here*/</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="nb">Integer</span><span class="p">,</span>
<span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="nb">Char</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
<span class="w">    </span><span class="k">c</span><span class="w"> </span><span class="nb">Decimal</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
<span class="w">    </span><span class="n">d</span><span class="w"> </span><span class="nb">Date</span>
<span class="p">)</span>
<span class="p">;</span>
</code></pre></div>

<p>If there is an existing table <code>t1</code> 
and you want to create another table <code>t2</code> with the same schema,
you can use</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t1</span>
<span class="k">WITH</span><span class="w"> </span><span class="k">NO</span><span class="w"> </span><span class="k">DATA</span><span class="p">;</span>
</code></pre></div>

<p>or</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="cm">/*as cannot be omitted here*/</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t1</span>
<span class="p">)</span>
<span class="k">WITH</span><span class="w"> </span><span class="k">NO</span><span class="w"> </span><span class="k">DATA</span>
<span class="k">PRIMARY</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">;</span>
</code></pre></div>

<p>Notice that the syntax of Teradata SQL is different from other SQL languages
when creating a table using a select clause.
You have to specify either <code>WITH DATA</code> or <code>WITH NO DATA</code>.
<code>WITH DATA</code> means that you want to append the selected records into the created table
while <code>WITH NO DATA</code> creates an empty table.</p>
<h2 id="database-information">Database Information</h2>
<ol>
<li>
<p>Get version of Teradata SQL.</p>
<p>:::sql
SELECT * FROM dbc.dbcinfo;</p>
</li>
</ol>
<h2 id="error-code">Error Code</h2>
<p>http://info.teradata.com/htmlpubs/DB_TTU_16_00/index.html#page/Query_Management_Tools/B035-2414-086K/BTEQReturnCodes_USE_2414.html#wwID0EKJNM
[TeraJDBC 15.10.00.14] [Error 9804] [SQLState HY000] Response Row size or Constant Row size overflow: might be because too large column definition
using distinct (the result has only about 1,000 rows) causes the following error, how can I avoid the issue? 
[Teradata Database] [TeraJDBC 15.10.00.22] [Error 2646] [SQLState HY000] No more spool space in dclong.
No More Spool Space http://kedar.nitty-witty.com/blog/no-more-spool-space-teradata-query-solution
Instead of distinct (which might cause "no more spool space" issue), you can try group by.</p>
<p><a href="https://docs.teradata.com/reader/bBJcqMYyoxECDlJRAz9Dgw/KE7j~J_ETi90ztaPV959YA">Teradata Database Messages</a></p>
<h2 id="error-message">Error Message</h2>
<ol>
<li>
<p>unknown error, probably network issue</p>
</li>
<li>
<p>Error code 3754: precision error, character, numeric, .. -&gt; float ...</p>
</li>
</ol>
<h2 id="date">Date</h2>
<p>Be careful when you work with date in SQL.
A non-exist date can result in tricky errors.
For example (note that <code>2016-09-31</code> does not exist)</p>
<div class="highlight"><pre><span></span><code><span class="k">WHERE</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2016-09-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2016-09-31&#39;</span>
</code></pre></div>

<p>in Teradata throws the error message "a character string failed to convert to a numeric value".</p>
<h2 id="references">References</h2>
<p>http://www.dwhpro.com/teradata-golden-tuning-tipps-2017/</p>
<p>http://community.teradata.com/t5/Database/Teradata-IDENTITY-columns/td-p/8025</p>
<p>http://www.info.teradata.com/HTMLPubs/DB_TTU_14_00/index.html#page/SQL_Reference/B035_1184_111A/Create_Table-Details.012.046.html</p>
<p>http://teradatafaqs.blogspot.com/2013/05/teradata-generated-identity-column.html</p>
<p>https://developer.teradata.com/uda/articles/working-with-identity-columns-and-unity-director-and-loader</p>
<p>http://www.info.teradata.com/htmlpubs/DB_TTU_14_00/index.html#page/SQL_Reference/B035_1184_111A/Create_Table-Details.012.045.html</p>
<p>https://community.teradata.com/t5/Analytics/identity-columns/td-p/143</p>
<p>http://forgetcode.com/Teradata/1741-INSERT-SELECT</p>
<p>http://forgetcode.com/Teradata/1779-ROW-NUMBER</p>
<p>http://www.dwhpro.com/ a very good teradata blog</p>
<p>http://kedar.nitty-witty.com/blog/no-more-spool-space-teradata-query-solution</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://outdated.legendu.net/tag/programming.html">programming</a>
      <a href="https://outdated.legendu.net/tag/tips.html">tips</a>
      <a href="https://outdated.legendu.net/tag/teradata-sql.html">Teradata SQL</a>
      <a href="https://outdated.legendu.net/tag/database.html">database</a>
    </p>
  </div>






<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'dclong';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    Please enable JavaScript to view comments.
</noscript>
<!-- End Disqus -->
</article>

<footer>
<p>&copy;  </p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="https://outdated.legendu.net/theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="False"
          data-default-theme="light"
          type="text/javascript">
  </script>
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Ben Chuanlong Du's Blog ",
  "url" : "https://outdated.legendu.net",
  "image": "",
  "description": ""
}
</script><a href="https://github.com/dclong/outdated" target="_blank" class="github-corner" aria-label="View source on Github">
    <svg width="80"
         height="80"
         viewBox="0 0 250 250"
         style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;"
         aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor"
              style="transform-origin: 130px 106px;"
              class="octo-arm">
        </path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor"
              class="octo-body">
        </path>
    </svg>
</a>
  <script src="https://outdated.legendu.net/theme/stork/stork.js"></script>
  <script>
    stork.register("sitesearch", "https://outdated.legendu.net/search-index.st", {showProgress: false});
  </script>

</body>
</html>